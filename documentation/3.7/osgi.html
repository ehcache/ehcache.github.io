<div class="sect1">
<h2 id="osgi-compatible-bundles"><a class="anchor" href="#osgi-compatible-bundles"></a>OSGi Compatible Bundles</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following Ehcache artifacts are also valid OSGi bundles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.ehcache:ehcache</code></p>
<div class="paragraph">
<p>includes: <code>api</code>, <code>core</code>, <code>impl</code>, <code>xml</code>, <code>107</code></p>
</div>
</li>
<li>
<p><code>org.ehcache:ehcache-clustered</code></p>
</li>
<li>
<p><code>org.ehcache:ehcache-transactions</code></p>
</li>
<li>
<p><code>org.ehcache.modules:ehcache-api</code></p>
</li>
<li>
<p><code>org.ehcache.modules:ehcache-core</code></p>
</li>
<li>
<p><code>org.ehcache.modules:ehcache-impl</code></p>
</li>
<li>
<p><code>org.ehcache.modules:ehcache-xml</code></p>
</li>
<li>
<p><code>org.ehcache.modules:ehcache-107</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ehcache-service-lookup-osgi"><a class="anchor" href="#ehcache-service-lookup-osgi"></a>Ehcache Service Lookup &amp; OSGi</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To allow for the extension of its feature set and to support the internal modularity of the source code, Ehcache uses
a <code>java.util.ServiceLoader</code> based lookup system to discover the set of available functionalities at runtime. When
deployed as bundles in an OSGi environment this lookup mechanism is replaced by a lookup mechanism based on OSGi
components. Activation of the bundle containing the Ehcache core code will result in the following logging</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-log" data-lang="log">org.ehcache[org.ehcache.core.osgi.EhcacheActivator] : Detected OSGi Environment (core is in bundle: org.ehcache [13]): Using OSGi Based Service Loading</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this mode, to enable transactional and/or clustered caching it is sufficient to just provision the
<code>org.ehcache:ehcache-transactions</code> and/or <code>org.ehcache:ehcache-clustered</code> bundles alongside the <code>org.ehcache:ehcache</code>
main bundle</p>
</div>
<div class="paragraph">
<p>When in this mode of operation it is also possible to provision the Ehcache modules as independent bundles. A minimal
Ehcache configuration will need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.ehcache.modules:ehcache-api</code></p>
</li>
<li>
<p><code>org.ehcache.modules:ehcache-core</code></p>
</li>
<li>
<p><code>org.ehcache.modules:ehcache-impl</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additional features can then be added by including one or more of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.ehcache.modules:ehcache-xml</code></p>
</li>
<li>
<p><code>org.ehcache.modules:ehcache-107</code></p>
</li>
<li>
<p><code>org.ehcache:ehcache-clustered</code></p>
</li>
<li>
<p><code>org.ehcache:ehcache-transactions</code></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="reverting-to-jdk-service-lookup"><a class="anchor" href="#reverting-to-jdk-service-lookup"></a>Reverting to JDK Service Lookup</h3>
<div class="paragraph">
<p>If the <code>org.ehcache.core.osgi</code> property is set to <code>"false"</code> as either a framework or system property then Ehcache will
fall back to the JDK based service lookup mechanism. This will result in the following log line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-log" data-lang="log">org.ehcache[org.ehcache.core.osgi.EhcacheActivator] : Detected OSGi Environment (core is in bundle: org.ehcache [13]): OSGi Based Service Loading Disabled Via System/Framework Property - Extensions Outside This Bundle Will Not Be Detected</code></pre>
</div>
</div>
<div class="paragraph">
<p>Enabling debug logging will show the detected set of services:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-log" data-lang="log">org.ehcache[org.ehcache.core.osgi.EhcacheActivator] : JDK Service Loading Sees:
	org.ehcache.impl.internal.store.heap.OnHeapStore$Provider
	org.ehcache.impl.internal.store.offheap.OffHeapStore$Provider
	org.ehcache.impl.internal.store.disk.OffHeapDiskStore$Provider
	org.ehcache.impl.internal.store.tiering.TieredStore$Provider
	org.ehcache.impl.internal.store.tiering.CompoundCachingTier$Provider
	org.ehcache.core.spi.time.TimeSourceService
	org.ehcache.spi.serialization.SerializationProvider
	org.ehcache.spi.loaderwriter.CacheLoaderWriterProvider
	org.ehcache.core.events.CacheEventListenerProvider
	org.ehcache.core.spi.service.ExecutionService
	org.ehcache.core.spi.service.LocalPersistenceService
	org.ehcache.impl.persistence.DefaultDiskResourceService
	org.ehcache.spi.loaderwriter.WriteBehindProvider
	org.ehcache.impl.internal.events.CacheEventDispatcherFactoryImpl
	org.ehcache.spi.copy.CopyProvider
	org.ehcache.core.spi.store.heap.SizeOfEngineProvider
	org.ehcache.core.spi.service.StatisticsService
	org.ehcache.spi.resilience.ResilienceStrategyProvider</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this configuration only features in the bundle with the Ehcache core classes are available. Using this service lookup
mechanism only the <code>org.ehcache:ehcache</code> (bundle symbolic name: <code>org.ehcache</code>) bundle can be succesfully deployed. Use
of this bundle provides for most of the regular Ehcache features, but <strong>does not support transactional or clustered
caching</strong>.</p>
</div>
<div class="paragraph">
<p>In order to use transactional or clustered caches in this environment the user must create their own bundle by merging
the <code>org.ehcache:ehcache</code> bundle with the <code>org.ehcache:ehcache-clustered</code> and/or <code>org.ehcache:ehcache-transactions</code>
bundles.  Care must be taken when creating the custom bundle that all of the <code>META-INF/services</code> files are correctly
merged to allow for correct service discovery.</p>
</div>
</div>
</div>
</div>