<div class="sect1">
<h2 id="about"><a class="anchor" href="#about"></a>About class loading</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since Ehcache is a library and supports user types both in configuration and in mapping keys or values,
it must offer flexibility around class loading.</p>
</div>
<div class="sect2">
<h3 id="cl-default"><a class="anchor" href="#cl-default"></a>Default classLoader in Ehcache</h3>
<div class="paragraph">
<p>The default <code>ClassLoader</code> from Ehcache will first try to use the thread context class loader, through <code>Thread.currentThread().getContextClassLoader()</code>.
In case this fails to load the requested resource, it will then use the <code>ClassLoader</code> that loaded the Ehcache internal classes.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cl-user-types"><a class="anchor" href="#cl-user-types"></a>Handling user types</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The way to configure a <code>ClassLoader</code> and the scope of its use differ between Java and XML based configurations.
However, regardless of the configuration method, each <code>CacheManager</code> and <code>Cache</code> is always linked individually to a specific <code>ClassLoader</code> instance.</p>
</div>
<div class="sect2">
<h3 id="cl-cfg-java"><a class="anchor" href="#cl-cfg-java"></a>Java configuration</h3>
<div class="paragraph">
<p>During the configuration of the <code>CacheManager</code> or <code>Cache</code>, there are multiple extension points where a user type can be involved.
This includes <code>Serializer</code>, <code>CacheLoaderWriter</code> and other similar companion objects.
You can usually give an instance of these types to the configuration or an instance of the class to use.
This effectively negates the need to think in terms of a class loader here.</p>
</div>
<div class="paragraph">
<p>However you can still pass a specific <code>ClassLoader</code> to the <code>CacheManager</code> configuration.
You can also give a specific <code>ClassLoader</code> per cache if you need to, taking precedence over the one configured at the <code>CacheManager</code> level.
These will be used <a href="#cl-runtime">at runtime</a>.</p>
</div>
<div class="paragraph">
<p>If no class loader is specified, the <a href="#cl-default">default class loader</a> from Ehcache will be used.</p>
</div>
</div>
<div class="sect2">
<h3 id="cl-cfg-xml"><a class="anchor" href="#cl-cfg-xml"></a>XML configuration</h3>
<div class="paragraph">
<p>When using XML to configure Ehcache, references to custom types are given through a fully qualified class name.
This means that transforming these <code>String</code> names into the proper class representation may require a specific <code>ClassLoader</code>.</p>
</div>
<div class="paragraph">
<p>In order to support this, the <code>XmlConfiguration</code> constructors can take <code>ClassLoader</code> parameters:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>public XmlConfiguration(URL url)</code></dt>
<dd>
<p>to use only default ClassLoader</p>
</dd>
<dt class="hdlist1"><code>public XmlConfiguration(URL url, final ClassLoader classLoader)</code></dt>
<dd>
<p>to use a specific ClassLoader at the CacheManager level</p>
</dd>
<dt class="hdlist1"><code>public XmlConfiguration(URL url, final ClassLoader classLoader, final Map&lt;String, ClassLoader&gt; cacheClassLoaders)</code></dt>
<dd>
<p>to use a specific <code>ClassLoader</code> at the <code>CacheManager</code> level and a map of <code>&lt;String, ClassLoader&gt;</code> which will be used to link a specific <code>ClassLoader</code> to a <code>Cache</code> by its alias</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In the same way as for the Java configuration, the <code>Cache</code> level configuration takes precedence over the <code>CacheManager</code> level one.
If no class loaders are specified, the default class loader from Ehcache will be used.</p>
</div>
</div>
<div class="sect2">
<h3 id="cl-runtime"><a class="anchor" href="#cl-runtime"></a>At runtime</h3>
<div class="paragraph">
<p>As soon as serialization is involved with <code>Cache</code> keys or values, the class loader plays a role at runtime.
The specific <code>ClassLoader</code> per <code>Cache</code> will be used by the serialization sub-system.
It will allow deserialization to types that may not be visible by the Ehcache <code>ClassLoader</code>.</p>
</div>
</div>
</div>
</div>