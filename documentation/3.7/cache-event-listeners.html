<div id="preamble">
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Clustering is not yet compatible with event listeners.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Cache listeners allow implementers to register callback methods that will be executed when a cache event occurs.</p>
</div>
<div class="paragraph">
<p>Listeners are registered at the cache level - and therefore only receive events for caches that they have been registered with.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-java" data-lang="java">CacheEventListenerConfigurationBuilder cacheEventListenerConfiguration = CacheEventListenerConfigurationBuilder
    .newEventListenerConfiguration(new ListenerObject(), EventType.CREATED, EventType.UPDATED) <i class="conum" data-value="1"></i><b>(1)</b>
    .unordered().asynchronous(); <i class="conum" data-value="2"></i><b>(2)</b>

final CacheManager manager = CacheManagerBuilder.newCacheManagerBuilder()
    .withCache("foo",
        CacheConfigurationBuilder.newCacheConfigurationBuilder(String.class, String.class, ResourcePoolsBuilder.heap(10))
            .add(cacheEventListenerConfiguration) <i class="conum" data-value="3"></i><b>(3)</b>
    ).build(true);

final Cache&lt;String, String&gt; cache = manager.getCache("foo", String.class, String.class);
cache.put("Hello", "World"); <i class="conum" data-value="4"></i><b>(4)</b>
cache.put("Hello", "Everyone"); <i class="conum" data-value="5"></i><b>(5)</b>
cache.remove("Hello"); <i class="conum" data-value="6"></i><b>(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create a <code>CacheEventListenerConfiguration</code> using the builder indicating the listener and the events to receive (in this case create and update events)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Optionally indicate the delivery mode - defaults are <em>asynchronous</em> and <em>un-ordered</em> (for performance reasons)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Pass the configuration of the listener into the cache configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>You will be notified on creation</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>And on update</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>But not on removal, because it wasn&#8217;t included at step 1</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Created, updated, and removed events are triggered by user execution of mutative methods as outlined in the table below.
Eviction and expiration events can be triggered by both internal processes and by user execution of methods targeting both related and unrelated keys within the cache.</p>
</div>
<table class="tableblock frame-topbot grid-all stretch">
<caption class="title">Table 1. Cache entry event firing behaviors for mutative methods</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 40%;">
<col style="width: 10%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Initial value</th>
<th class="tableblock halign-left valign-top">Operation</th>
<th class="tableblock halign-center valign-top">New value</th>
<th class="tableblock halign-left valign-top">Event {key, old-value, new-value}</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>{}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>put(K, V)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>{K, V}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>created {K, null, V}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>{K, V1}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>put(K, V2)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>{K, V2}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>updated {K, V1, V2}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>{}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>put(K, V) [immediately expired]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>{}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>none</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>{K, V1}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>put(K, V2) [immediately expired]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>{}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>none</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>{}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>putIfAbsent(K, V)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>{K, V}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>created {K, null, V}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>{}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>putIfAbsent(K, V) [immediately expired]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>{}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>none</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>{K, V1}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>replace(K, V2)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>{K, V2}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>updated {K, V1, V2}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>{K, V1}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>replace(K, V2) [immediately expired]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>{}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>none</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>{K, V1}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>replace(K, V1, V2)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>{K, V2}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>updated {K, V1, V2}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>{K, V1}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>replace(K, V1, V2) [immediately expired]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>{}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>no events</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>{K, V}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>remove(K)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>{}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>removed {K, V, null}</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Ehcache provides an abstract class <code>CacheEventAdapter</code> for convenient implementation of event listeners when you are interested only on specific events.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registering-during-runtime"><a class="anchor" href="#registering-during-runtime"></a>Registering Event Listeners during runtime</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Cache event listeners may also be added and removed while the cache is being used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-java" data-lang="java">ListenerObject listener = new ListenerObject(); <i class="conum" data-value="1"></i><b>(1)</b>
cache.getRuntimeConfiguration().registerCacheEventListener(listener, EventOrdering.ORDERED,
    EventFiring.ASYNCHRONOUS, EnumSet.of(EventType.CREATED, EventType.REMOVED)); <i class="conum" data-value="2"></i><b>(2)</b>

cache.put(1L, "one");
cache.put(2L, "two");
cache.remove(1L);
cache.remove(2L);

cache.getRuntimeConfiguration().deregisterCacheEventListener(listener); <i class="conum" data-value="3"></i><b>(3)</b>

cache.put(1L, "one again");
cache.remove(1L);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create a <code>CacheEventListener</code> implementation instance.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Register it on the <code>RuntimeConfiguration</code>, indicating the delivery mode and events of interest.
The following <code>put()</code> and <code>remove()</code> cache calls will make the listener receive events.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Unregister the previously registered <code>CacheEventListener</code> instance.
The following <code>put()</code> and <code>remove()</code> cache calls will have no effect on the listener anymore.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="queues"><a class="anchor" href="#queues"></a>Event Processing Queues</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Advanced users may want to tune the level of concurrency which may be used for delivery of events:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-java" data-lang="java">CacheConfiguration&lt;Long, String&gt; cacheConfiguration = CacheConfigurationBuilder.newCacheConfigurationBuilder(Long.class, String.class,
                                                                                      ResourcePoolsBuilder.heap(5L))
    .withDispatcherConcurrency(10) <i class="conum" data-value="1"></i><b>(1)</b>
    .withEventListenersThreadPool("listeners-pool")
    .build();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Indicate the level of concurrency desired</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This will enable parallel processing of events at the cost of more threads being required by the system.</p>
</div>
</div>
</div>